<div align="center">

# AutoCar: 自动巡线小车 - 自动化认知与实践课程项目 <!-- omit in toc -->

**中文** | [English](/README_en.md)

</div>

## 内容 <!-- omit in toc -->

- [简介](#简介)
- [项目结构](#项目结构)
- [代码运行逻辑](#代码运行逻辑)
- [功能具体实现](#功能具体实现)
- [使用方法](#使用方法)
- [项目成果展示](#项目成果展示)
- [开源协议](#开源协议)

## 简介

本项目是哈尔滨工业大学（深圳）AUTO1001 - [自动化认知与实践](https://github.com/HITSZ-OpenAuto/AUTO1001)课程于 2022 年的考核项目：**自动巡线小车**。由 [pspdada](https://github.com/pspdada) 编写，旨在为同学们提供参考。


本次考核包括**竞速**和**避障**两个部分，可用不同代码完成：

- 在**竞速**部分，小车需在固定轨迹的起点使用自行设计的机械夹爪拿起一个圆柱体，后循迹到终点，途中会遇到半圆形弯道、直角转弯等复杂情况，需要灵活处理。到了终点，需要将圆柱体平稳放下。
- 在**避障**部分，只需考核小车探测障碍并作出反应的能力，避障之后要求能够回到路线上继续行驶。

对应开发板：Arduino Mega 2560

考核时间: 2023.3.19 15:00，分数: 35/35

## 项目结构

核心代码在本项目的 [`AutoCar`](/AutoCar) 文件夹下，包含以下 `.ino` 和 `.h` 文件：

- `AutoCar_def`: 宏定义项目用到的常量、引脚和数据类型等，根据实际情况修改
- `control`: 控制小车的运动，包括三个部分
  - `runMode()`: 根据红外传感器的输出来决定小车运动模式
  - `motorControl()`: 根据小车运动模式选择小车两轮的目标速度
  - `carRun()`: 根据小车两轮的目标速度来输出 PWM 波控制小车
- `ctrt`: 红外模块相关功能
  - `updateCTRTState()`: 更新红外模块的记忆数组
- `encoder`: 编码器中断函数，用于获取电机的编码器值
- `pid`: 实现 PID 控制器算法
- `robotic_arm`: 机械臂控制相关功能
  - `servoGrab()`: 控制机械臂夹取物品
  - `servoDrop()`: 控制机械臂放下物品

## 代码运行逻辑

1.  **初始化：** 上电后，执行初始化代码并暂停。
2.  **启动：** 按下按钮后，程序继续运行。
3.  **夹取：** 机械臂夹取物品。
4.  **循迹：**
    - 红外传感器读取数据，确定运动模式（直行、左转、右转等）。
    - 根据运动模式，设置左右轮的目标速度。
    - 编码器读取电机值，计算轮子当前速度。
    - PID 控制器根据目标速度和当前速度，计算输出量驱动电机。
5.  **避障：** 遇到障碍物时，优先躲避，避障后返回原路线。
6.  **终点：** 到达终点线，执行放下物品动作，停止运动。

## 功能具体实现

**直角转弯：** 采用"寄存器 + 越界检测"方法，即使红外传感器超出预定轨迹，也能根据历史状态判断转向，避免冲出轨迹。

## 使用方法

1.  **配置：** 根据实际接线修改 `AutoCar_def.h` 文件中的定义。
2.  **上传：** 将代码上传到 Arduino Mega 2560 开发板。

## 项目成果展示

以下是我们项目完成后的实物照片。AUTO1001 课程的这一项目，是一个具有实践价值的学习项目。我们希望通过这个项目，大家能够深入理解自动控制的相关知识，并顺利完成项目制作。

<table align="center">
    <p align="center">
      <img src="docs/picture1.jpg" width="80%" />
    </p>
    <p align="center">
      <img src="docs/picture2.jpg" width="80%" />
    </p>
    <p align="center">
      <img src="docs/picture3.jpg" width="80%" />
    </p>
</table>

## 开源协议

本项目使用 Apache 2.0 开源协议，详情请见 [LICENSE](LICENSE) 文件。